<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EDITOR ELITE V13</title>
    <style>
        :root { --bg: #0a0c10; --card: #161b22; --border: #30363d; --gold: #d29922; --text: #c9d1d9; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; overflow-x: hidden; }
       
        /* HEADER ORIGINAL */
        header { padding: 10px 15px; background: #000; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 1000; }
        .btn-tool { background: none; border: 1px solid var(--gold); color: var(--gold); padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 20px; font-weight: bold; }
        .disket { background: var(--gold); color: #000; border: none; font-size: 24px; }
       
        select { background: #000; color: var(--gold); border: 1px solid var(--gold); padding: 10px; font-weight: 900; border-radius: 5px; flex: 1; margin: 0 10px; text-transform: uppercase; outline: none; }

        /* A FOLHA DE 150 LINHAS */
        .scroller-folha { background: #cbd5e1; padding: 20px 10px; min-height: 100vh; display: flex; justify-content: center; }
        .folha-fgv { background: white; width: 100%; max-width: 850px; box-shadow: 0 0 25px rgba(0,0,0,0.4); border: 1px solid #000; }
        .linha-producao { display: flex; min-height: 32px; border-bottom: 1px solid #e2e8f0; }
        .margem-num { width: 45px; border-right: 2px solid #000; background: #f1f5f9; display: flex; align-items: center; justify-content: center; font-size: 11px; color: #000; font-weight: 900; }
        .texto-escrita { flex: 1; padding: 0 15px; font-family: 'Courier New', monospace; font-size: 19px; color: #000; line-height: 32px; outline: none; text-transform: uppercase; font-weight: 700; white-space: nowrap; overflow: hidden; }

        /* POST-ITS LATERAIS */
        .area-postits { position: fixed; right: 15px; top: 80px; display: flex; flex-direction: column; gap: 10px; z-index: 500; }
        .post-it { background: #ffde59; color: #000; padding: 10px; border-radius: 2px; font-size: 11px; font-weight: bold; width: 110px; box-shadow: 3px 3px 10px rgba(0,0,0,0.3); border-left: 4px solid #d29922; cursor: pointer; }

        @media (max-width: 600px) { .area-postits { display: none; } }
    </style>
</head>
<body>

<header>
    <button class="btn-tool" onclick="window.location.href='mentoria.html'">ðŸ“œ</button>
    <select id="radar-exame">
        <option value="">SELECIONE O EXAME</option>
        <option value="44">EXAME 44 (RO)</option>
        <option value="43">EXAME 43 (CONTESTAÃ‡ÃƒO)</option>
        <option value="42">EXAME 42 (CONSIGNAÃ‡ÃƒO)</option>
        <option value="41">EXAME 41 (RO)</option>
        <option value="40">EXAME 40 (CONTESTAÃ‡ÃƒO)</option>
        <option value="39">EXAME 39 (RT)</option>
    </select>
    <button class="btn-tool disket" onclick="salvarNoHistorico()">ðŸ’¾</button>
</header>

<div class="area-postits">
    <div class="post-it">ðŸ’¡ PRELIMINARES</div>
    <div class="post-it">ðŸ’¡ TESES MÃ‰RITO</div>
</div>

<div class="scroller-folha">
    <div class="folha-fgv" id="corpo-folha">
        </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const config = {
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ",
        authDomain: "masteroab-db5e1.firebaseapp.com",
        projectId: "masteroab-db5e1",
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(config);
    const db = getDatabase(app);

    // GERAR AS 150 LINHAS ORIGINAIS
    const folha = document.getElementById('corpo-folha');
    for(let i=1; i<=150; i++) {
        const linha = document.createElement('div');
        linha.className = 'linha-producao';
        linha.innerHTML = `<div class="margem-num">${i}</div><div class="texto-escrita" contenteditable="true"></div>`;
        folha.appendChild(linha);
    }

    // FUNÃ‡ÃƒO SALVAR - CONECTADA COM A MENTORIA V13
    window.salvarNoHistorico = async () => {
        const select = document.getElementById('radar-exame');
        const exameVal = select.value;
        const pecaNome = select.options[select.selectedIndex].text.split('(')[1]?.replace(')', '') || "PEÃ‡A";

        if(!exameVal) return alert("Selecione o Exame antes de salvar!");

        const linhasCapturadas = [];
        document.querySelectorAll('.texto-escrita').forEach(el => {
            linhasCapturadas.push(el.innerText || "");
        });

        // Verifica se hÃ¡ conteÃºdo para salvar
        const temConteudo = linhasCapturadas.some(l => l.trim() !== "");
        if(!temConteudo) return alert("A folha estÃ¡ vazia!");

        try {
            await push(ref(db, 'producao_v13'), {
                exame: exameVal,
                nome_peca: pecaNome,
                linhas: linhasCapturadas,
                timestamp: serverTimestamp()
            });
            alert("âœ… PEÃ‡A ENVIADA PARA O HISTÃ“RICO!");
        } catch (e) {
            console.error(e);
            alert("Erro ao salvar. Verifique a conexÃ£o.");
        }
    };
</script>
</body>
</html>
