<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const config = { 
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ", 
        authDomain: "masteroab-db5e1.firebaseapp.com", 
        projectId: "masteroab-db5e1", 
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com" 
    };
    const app = initializeApp(config);
    const db = getDatabase(app);

    // Radar Integrado
    const RadarElite = {
        analisar: (texto) => {
            const t = texto.toUpperCase();
            if(t.includes("AGRAVO DE PETIÇÃO")) return "AGRAVO DE PETIÇÃO";
            if(t.includes("RECURSO ORDINÁRIO")) return "RECURSO ORDINÁRIO";
            if(t.includes("CONTESTAÇÃO")) return "CONTESTAÇÃO";
            if(t.includes("RECLAMAÇÃO")) return "RECLAMATÓRIA TRABALHISTA";
            return "PEÇA EM ANÁLISE";
        }
    };

    // Montar Folha e Lógica de Input (igual ao anterior)
    // ...

    window.salvarProducao = () => {
        const identificador = document.getElementById('identificador-peca').innerText;
        const linhas = Array.from(document.querySelectorAll('.linha-folha')).map(i => i.value);
        const exame = localStorage.getItem('activeEx') || "44";
        const idSessao = Date.now();

        // O PDF que você disse que funcionava (exemplo da FGV)
        const linkPdfProva = `https://oab.fgv.br/provas/exame${exame}/peca_pratica.pdf`;

        // SALVAMENTO SINCRONIZADO NO CAMINHO 'estudos'
        set(ref(db, 'estudos/' + idSessao), {
            exame: exame,
            pecaNome: identificador,
            linhasEscritas: linhas, // O seu texto
            arquivoPdf: linkPdfProva, // O PDF da prova
            ts: serverTimestamp(),
            dataHumanizada: new Date().toLocaleString()
        }).then(() => {
            alert(`☁️ REGISTRADO NO HISTÓRICO ELITE! EXAME ${exame} - ${identificador}`);
        }).catch(e => alert("Erro ao salvar: " + e));
    };
</script>
