<script type="module">
    import { db } from './firebase-config.js';
    import { ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
    import { BANCO_ESPELHOS } from './banco-espelhos.js';
    import { pecas } from './estruturas.js';
    
    // IMPORTAÇÃO DA FOLHA EXTERNA
    import { FolhaEngine } from './folha-engine.js';

    let activeEx = localStorage.getItem('activeEx') || "44";
    let ultimaLinhaFocada = 1;
    const LIMITE_LINHA = 85;

    window.montarFolha = () => {
        // CHAMA O MOTOR
        FolhaEngine.montar('folha-total', LIMITE_LINHA);
        
        // Reatribui as funções de foco e teclado
        document.querySelectorAll('.linha-folha').forEach((input, index) => {
            const i = index + 1;
            input.onfocus = () => { ultimaLinhaFocada = i; };
            input.onkeydown = (e) => {
                if(e.key === "Enter") { 
                    e.preventDefault(); 
                    document.getElementById(`L${i+1}`)?.focus(); 
                }
            };
        });
        carregarDados();
    };

    // ... (restante das suas funções como escaneamentoElite, salvarManual, etc)
    window.onload = montarFolha;
</script>
