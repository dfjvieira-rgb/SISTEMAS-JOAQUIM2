<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>JOAQUIM ELITE 2026 - IMPRESS√ÉO A4</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #0f172a; --gold: #fbbf24; --bg-paper: #cbd5e1;
            --paper-color: #ffffff; --text-color: #1e293b; --line-color: #d1d5db;
            --header-h: 60px; --sidebar-w: 80px;
        }
        
        /* ESTILO DE TELA */
        body.dark-mode { --primary: #020617; --bg-paper: #0f172a; --paper-color: #ffffff; --text-color: #1e293b; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: var(--primary); height: 100dvh; display: flex; flex-direction: column; }
        header { background: var(--primary); height: var(--header-h); padding: 0 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--gold); }
        main { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: var(--sidebar-w); background: #1e293b; display: flex; flex-direction: column; gap: 8px; padding: 10px; border-right: 1px solid rgba(255,255,255,0.1); }
        .btn-side { width: 100%; min-height: 44px; border-radius: 8px; border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .editor-container { flex: 1; overflow-y: auto; display: flex; justify-content: center; padding: 40px 20px; background: var(--bg-paper); }
        
        /* O PAPEL */
        .paper { 
            background: #fff; 
            width: 210mm; 
            min-height: 297mm; 
            padding: 20mm; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            position: relative;
        }
        
        #identificador-peca { 
            width: 100%; 
            padding: 10px; 
            text-align: center; 
            font-weight: 900; 
            font-size: 1.2rem; 
            color: #000; 
            border: 2px solid #000;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .linha-wrapper { display: flex; border-bottom: 1px solid #000; align-items: center; }
        .linha-num { width: 35px; font-size: 0.8rem; color: #000; text-align: center; border-right: 1px solid #000; font-weight: bold; padding: 5px 0; }
        .linha-folha { 
            flex: 1; 
            border: none; 
            outline: none; 
            background: transparent; 
            padding: 0 10px; 
            font-size: 14pt; 
            font-family: 'Courier New', monospace; 
            color: #000;
            line-height: 1.5;
        }

        /* üöÄ MOTOR DE IMPRESS√ÉO A4 BLINDADO [cite: 2026-01-30] */
        @media print {
            @page { size: A4; margin: 0; }
            body { background: #fff !important; }
            header, .sidebar, .btn-side, .btn-close-pdf, #pdf-split-view { display: none !important; }
            main { display: block !important; }
            .editor-container { padding: 0 !important; background: #fff !important; display: block !important; overflow: visible !important; }
            .paper { 
                width: 210mm !important; 
                height: 297mm !important; 
                margin: 0 !important; 
                padding: 15mm !important; 
                box-shadow: none !important; 
                border: none !important;
            }
            .linha-folha { color: #000 !important; }
            .linha-num { color: #000 !important; border-right: 1px solid #000 !important; }
            .linha-wrapper { border-bottom: 1px solid #000 !important; }
            #identificador-peca { border: 2px solid #000 !important; color: #000 !important; }
        }
    </style>
</head>
<body>

<header>
    <div style="color:white; font-weight:900;">JOAQUIM <span style="color:var(--gold)">ELITE 2026</span></div>
    <button class="btn-side" style="width:40px; background:#10b981;" onclick="window.print()"><i class="fas fa-print"></i></button>
</header>

<main>
    <aside class="sidebar">
        <button class="btn-side" style="background:#0ea5e9;" onclick="salvarManual()"><i class="fas fa-save"></i></button>
        <button class="btn-side" style="background:#10b981;" onclick="window.print()"><i class="fas fa-print"></i></button>
    </aside>

    <section class="editor-container">
        <div class="paper" id="printable-paper">
            <div id="identificador-peca">CARREGANDO...</div>
            <div id="folha-total"></div>
        </div>
    </section>
</main>

<script type="module">
    import { db } from './firebase-config.js';
    import { ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
    import { FolhaEngine } from './folha-engine.js';
    import { BANCO_ESPELHOS } from './banco-espelhos.js';

    let activeEx = localStorage.getItem('activeEx') || "44";

    window.montarFolha = () => {
        FolhaEngine.montar('folha-total', 85);
        carregarDados();
    };

    window.carregarDados = () => {
        onValue(ref(db, 'estudos/' + activeEx), (snap) => {
            const data = snap.val();
            if (data && data.linhas) {
                data.linhas.forEach((txt, idx) => {
                    const el = document.getElementById(`L${idx + 1}`);
                    if (el) el.value = txt;
                });
            }
            document.getElementById('identificador-peca').innerText = "FOLHA DE RESPOSTAS - FGV";
        }, { onlyOnce: true });
    };

    window.salvarManual = () => {
        const dados = Array.from(document.querySelectorAll('.linha-folha')).map(i => i.value);
        set(ref(db, 'estudos/' + activeEx), { linhas: dados, ts: Date.now() }).then(() => alert("‚òÅÔ∏è SINCRONIZADO!"));
    };

    window.onload = montarFolha;
</script>
</body>
</html>
