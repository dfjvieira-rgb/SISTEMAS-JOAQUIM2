window.verTreino = (id) => {
        get(ref(db, 'producao_v13/' + id)).then((s) => {
            if(!s.exists()) return alert("Peça não encontrada!");
            const p = s.val();
            const win = window.open('', '_blank');
            const baseLinhas = p.linhas || p.conteudo || [];
            
            const linhasHtml = baseLinhas.map((l, i) => `
                <div style="display:flex; border-bottom:1px solid #e2e8f0; min-height:30px; background: ${i % 2 === 0 ? '#ffffff' : '#f8fafc'}; width:100%;">
                    <div style="min-width:40px; width:40px; font-size:11px; color:#94a3b8; border-right:3px solid #fbbf24; padding:8px 5px; text-align:right; font-weight:900; background:#f1f5f9; flex-shrink:0;">
                        ${i+1}
                    </div>
                    <div style="flex:1; font-family:'Courier New', monospace; font-size:16px; color:#1e293b; word-break:break-word; padding:6px 10px; line-height:1.6; white-space: pre-wrap;">
                        ${l || ""}
                    </div>
                </div>`).join('');

            win.document.write(`
                <html>
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
                    <style>
                        body { margin:0; padding:10px; background:#0f172a; font-family:sans-serif; }
                        .paper { background:white; border-radius:12px; max-width:100%; margin:auto; overflow:hidden; display:flex; flex-direction:column; box-shadow:0 10px 20px rgba(0,0,0,0.4); }
                        .header { background:#1e293b; color:white; padding:15px; text-align:center; border-bottom:4px solid #fbbf24; }
                        .header h3 { margin:5px 0; color:#fbbf24; text-transform:uppercase; font-size:1rem; }
                        .content { width:100%; overflow-x:hidden; }
                        .footer { position:sticky; bottom:0; background:white; padding:12px; border-top:2px solid #fbbf24; display:flex; gap:10px; }
                        button { flex:1; padding:15px; border:none; border-radius:8px; font-weight:bold; text-transform:uppercase; font-size:12px; }
                        @media print { .no-print { display:none; } }
                    </style>
                </head>
                <body>
                    <div class="paper">
                        <div class="header">
                            <small>EXAME ${p.exame || "---"}</small>
                            <h3>${p.nome_peca || p.peca || "PEÇA ELITE"}</h3>
                            <small>${p.data_envio}</small>
                        </div>
                        <div class="content">
                            ${linhasHtml}
                        </div>
                        <div class="footer no-print">
                            <button onclick="window.print()" style="background:#fbbf24; color:black;">PDF / Imprimir</button>
                            <button onclick="window.close()" style="background:black; color:white;">Fechar</button>
                        </div>
                    </div>
                </body>
                </html>`);
        });
    };
