// --- CORTE CIRÃšRGICO: LIGAÃ‡ÃƒO DO BOTÃƒO "MINHA PASTA" ---

window.gerenciadorPasta = async () => {
    const modal = document.getElementById('universal-modal');
    const content = document.getElementById('modal-content');
    const backBtn = document.getElementById('modal-back-btn');
    
    document.getElementById('modal-title').innerText = "ðŸ“‚ MINHA PASTA (TREINOS)";
    if(backBtn) backBtn.style.display = 'none'; // Esconde botÃ£o voltar na raiz da pasta
    content.innerHTML = "<div style='text-align:center; padding:20px;'><i class='fas fa-spinner fa-spin'></i> Carregando seus treinos...</div>";
    modal.style.display = 'flex';

    try {
        const snap = await get(ref(db, `producao_v13/HISTORICO_OFICIAL`));
        content.innerHTML = "";

        if (snap.exists()) {
            const treinos = snap.val();
            // Inverte para mostrar o mais recente primeiro
            Object.keys(treinos).reverse().forEach(id => {
                const item = treinos[id];
                const btn = document.createElement('div');
                btn.className = 'opt-btn';
                btn.style.fontSize = '0.75rem';
                btn.innerHTML = `
                    <div style="display:flex; flex-direction:column; gap:4px;">
                        <span style="color:#0f172a; font-weight:900;">${item.peca || 'SEM NOME'}</span>
                        <small style="color:#64748b; font-size:10px;">${item.exame || ''}</small>
                    </div>
                    <i class="fas fa-file-alt" style="color:var(--gold)"></i>
                `;
                btn.onclick = () => {
                    if(confirm("Carregar este treino na folha? (O rascunho atual serÃ¡ substituÃ­do)")) {
                        document.getElementById('editor-principal').innerHTML = item.conteudo;
                        modal.style.display = 'none';
                    }
                };
                content.appendChild(btn);
            });
        } else {
            content.innerHTML = "<div style='text-align:center; padding:20px; color:#64748b;'>Nenhum treino salvo ainda.</div>";
        }
    } catch (error) {
        console.error(error);
        content.innerHTML = "<div style='color:red; padding:20px;'>Erro ao carregar pasta.</div>";
    }
};

// --- FIM DO AJUSTE ---
